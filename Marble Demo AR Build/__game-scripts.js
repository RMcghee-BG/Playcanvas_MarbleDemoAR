var Follow=pc.createScript("follow");Follow.attributes.add("target",{type:"entity",title:"Target",description:"The Entity to follow"}),Follow.attributes.add("distance",{type:"number",default:4,title:"Distance",description:"How far from the Entity should the follower be"}),Follow.prototype.initialize=function(){this.vec=new pc.Vec3;var t=this;this.app.xr.on("start",(function(){t.enabled=!1}))},Follow.prototype.update=function(t){if(this.target&&this.target.enabled){var e=this.target.getPosition();e.x+=.75*this.distance,e.y+=1*this.distance,e.z+=.75*this.distance,this.vec.lerp(this.vec,e,.1),this.entity.setPosition(this.vec)}};var Movement=pc.createScript("movement");Movement.attributes.add("speed",{type:"number",default:.1,min:.5,max:5,precision:3}),Movement.attributes.add("camera",{type:"entity"}),Movement.prototype.initialize=function(){this.force=new pc.Vec3,this.resetHeight=-2.5,this.app.on("xr:hitTestPointerPressed",this.xrHitTestPointerPressed,this),this.entity.collision.on("collisionstart",this.onCollisionStart,this)},Movement.prototype.update=function(e){var t=window.touchJoypad.sticks.joystick0;t&&t.isPressed?this.joystickMovement(e):this.keyboardMovement(e),this.entity.getPosition().y<this.resetHeight&&this.app.fire("player:resetBall")},Movement.prototype.joystickMovement=function(e){var t,s,i=window.touchJoypad.sticks.joystick0;t=i.x*this.speed,s=i.y*this.speed,this.addForce(t,s,e)},Movement.prototype.keyboardMovement=function(e){var t=0,s=0;this.app.keyboard.isPressed(pc.KEY_A)?t=-this.speed:this.app.keyboard.isPressed(pc.KEY_D)&&(t=this.speed),this.app.keyboard.isPressed(pc.KEY_W)?s=this.speed:this.app.keyboard.isPressed(pc.KEY_S)&&(s=-this.speed),this.addForce(t,s,e)},Movement.prototype.addForce=function(e,t,s){var i=new pc.Vec3(this.camera.forward.x,0,this.camera.forward.z);i.scale(t);var o=new pc.Vec3(this.camera.right.x,0,this.camera.right.z);o.scale(e),this.force=new pc.Vec3(x=i.x+o.x,y=0,z=i.z+o.z),this.force.length()&&this.force.length()>this.speed&&this.force.normalize().scale(this.speed),this.entity.rigidbody.applyImpulse(this.force.scale(s))},Movement.prototype.xrHitTestPointerPressed=function(e,t){this.resetHeight=e.y-2,this.app.off("xr:hitTestPointerPressed",this.xrHitTestPointerPressed,this)},Movement.prototype.onCollisionStart=function(e){e.other.tags.has("XR Plane")&&this.app.fire("player:resetBall")};var Teleportable=pc.createScript("teleportable");Teleportable.prototype.initialize=function(){this.lastTeleportFrom=null,this.lastTeleportTo=null,this.lastTeleport=Date.now(),this.startPosition=this.entity.getPosition().clone()},Teleportable.prototype.teleport=function(t,e){var i;t&&Date.now()-this.lastTeleport<500||(this.lastTeleport=Date.now(),this.lastTeleportFrom=t,this.lastTeleportTo=e,e?(i=e.getPosition()).y+=.5:i=this.startPosition,this.entity.rigidbody.teleport(i),this.entity.rigidbody.linearVelocity=pc.Vec3.ZERO,this.entity.rigidbody.angularVelocity=pc.Vec3.ZERO)};var Teleporter=pc.createScript("teleporter");Teleporter.attributes.add("target",{type:"entity",title:"Target Entity",description:"The target entity where we are going to teleport"}),Teleporter.prototype.initialize=function(){this.target&&this.entity.collision.on("triggerenter",this.onTriggerEnter,this)},Teleporter.prototype.onTriggerEnter=function(t){t.tags.has("player")&&t.script.teleportable&&(console.log("Player Teleporting"),t.script.teleportable.teleport(this.entity,this.target))};var GameManager=pc.createScript("gameManager");GameManager.attributes.add("xrManager",{type:"entity",title:"XR Manager"}),GameManager.attributes.add("playerBall",{type:"entity",title:"Player Ball"}),GameManager.attributes.add("startLevel",{type:"number",title:"Start Level"}),GameManager.attributes.add("levels",{type:"asset",array:!0,default:[""],title:"Game Levels"}),GameManager.attributes.add("levelParent",{type:"entity",title:"Level Parent"}),GameManager.attributes.add("splashUI",{type:"entity",title:"Splash UI"}),GameManager.attributes.add("arSplashUI",{type:"entity",title:"AR Splash UI"}),GameManager.attributes.add("gameUI",{type:"entity",title:"Game UI"}),GameManager.prototype.initialize=function(){this.currentLevelNumber=-1,this.currentSpawnedLevel=null,this.placementPos=new pc.Vec3(0,0,0),this.app.on("player:endGoalHit",this.endGoalHit,this),this.app.on("player:resetBall",this.resetBall,this),this.startLevel>=0?this.startGame(this.startLevel):this.startSplash()},GameManager.prototype.update=function(e){this.playerBall&&this.playerBall.enabled},GameManager.prototype.startSplash=function(){this.playerBall.enabled=!1,this.splashUI.enabled=!0,this.arSplashUI.enabled=!1,this.gameUI.enabled=!1},GameManager.prototype.startARSplash=function(){this.xrManager.script.xrBasic.startXR()&&(this.splashUI.enabled=!1,this.arSplashUI.enabled=!0,this.gameUI.enabled=!1,this.app.on("xr:hitTestPointerPressed",this.xrHitTestPointerPressed,this),this.app.fire("xr:enableHitTestPointer"))},GameManager.prototype.startGame=function(e){this.spawnLevel(e),this.resetBall(),this.splashUI.enabled=!1,this.arSplashUI.enabled=!1,this.gameUI.enabled=!0,this.app.fire("game:startGameTimer")},GameManager.prototype.spawnLevel=function(e){if(this.currentLevelNumber!==e&&this.levels[e]){this.currentSpawnedLevel&&(this.currentSpawnedLevel.destroy(),this.currentSpawnedLevel=null);var t=this.levels[e].resource.instantiate();this.levelParent.addChild(t),t.setPosition(this.placementPos),this.currentLevelNumber=e,this.currentSpawnedLevel=t}},GameManager.prototype.spawnNextLevel=function(){var e=this.currentLevelNumber+1;console.log("Spawning Next Level"),console.log("Current Level = "+String(this.currentLevelNumber)),console.log("Next Level = "+String(e)),this.spawnLevel(e)},GameManager.prototype.spawnPrevLevel=function(){var e=this.currentLevelNumber-1;console.log("Spawning Previous Level"),console.log("Current Level = "+String(this.currentLevelNumber)),console.log("Prev Level = "+String(e)),this.spawnLevel(e)},GameManager.prototype.isLastLevel=function(){return this.levels.length===this.currentLevelNumber+1},GameManager.prototype.resetBall=function(){var e=new pc.Vec3(0,0,0);this.currentSpawnedLevel&&this.currentSpawnedLevel.script.levelData.spawnPoint&&(e=this.currentSpawnedLevel.script.levelData.spawnPoint.getPosition()),this.playerBall.enabled=!0,this.playerBall.rigidbody.teleport(e),this.playerBall.rigidbody.linearVelocity=pc.Vec3.ZERO,this.playerBall.rigidbody.angularVelocity=pc.Vec3.ZERO},GameManager.prototype.endGoalHit=function(){this.isLastLevel()?(this.playerBall.destroy(),this.app.fire("game:stopGameTimer")):(this.spawnNextLevel(),this.resetBall())},GameManager.prototype.gemCollected=function(){},GameManager.prototype.xrHitTestPointerPressed=function(e,t){this.placementPos=e,this.app.off("xr:hitTestPointerPressed",this.xrHitTestPointerPressed,this),this.app.fire("xr:disableHitTestPointer"),this.startGame(0)};var LevelData=pc.createScript("levelData");LevelData.attributes.add("spawnPoint",{type:"entity",title:"Spawn Point"});var EndGoal=pc.createScript("endGoal");EndGoal.prototype.initialize=function(){this.entity.collision.on("triggerenter",this.onTriggerEnter,this)},EndGoal.prototype.onTriggerEnter=function(t){t.tags.has("player")&&(console.log("Player Hit End Goal"),this.app.fire("player:endGoalHit"))};var LevelTimer=pc.createScript("levelTimer");LevelTimer.attributes.add("timerText",{type:"entity",title:"Timer Text"}),LevelTimer.prototype.initialize=function(){this.app.on("game:startGameTimer",this.startTimer,this),this.app.on("game:stopGameTimer",this.stopTimer,this)},LevelTimer.prototype.update=function(e){this.timerEnabled&&(this.currentTime=this.currentTime+e,this.timerText&&(this.timerText.element.text=String(this.currentTime.toFixed(2))))},LevelTimer.prototype.startTimer=function(){this.timerEnabled||(this.currentTime=0,this.timerEnabled=!0)},LevelTimer.prototype.stopTimer=function(){this.timerEnabled&&(this.timerEnabled=!1)};var Gem=pc.createScript("gem");Gem.prototype.initialize=function(){this.entity.collision.on("triggerenter",this.onTriggerEnter,this)},Gem.prototype.onTriggerEnter=function(e){e.tags.has("player")&&(console.log("Player Collected Gem"),this.app.fire("player:gemCollected"),this.entity.destroy())};var RotateOverTime=pc.createScript("rotateOverTime");RotateOverTime.attributes.add("rotationSpeed",{type:"number",title:"Rotation Speed "}),RotateOverTime.attributes.add("rotationTarget",{type:"entity",title:"Rotation Target "}),RotateOverTime.prototype.initialize=function(){},RotateOverTime.prototype.update=function(t){this.rotationTarget&&this.rotationTarget.rotate(0,this.rotationSpeed*t,0)};var StartButton=pc.createScript("startButton");StartButton.attributes.add("gameManager",{type:"entity",title:"Game Manager"}),StartButton.prototype.initialize=function(){this.entity.button.on("click",this.clickButton,this)},StartButton.prototype.clickButton=function(){this.gameManager.script.gameManager.startGame(0)};"undefined"!=typeof document&&(
/*! FPSMeter 0.3.1 - 9th May 2013 | https://github.com/Darsain/fpsmeter */
function(t,e){function s(t,e){for(var n in e)try{t.style[n]=e[n]}catch(t){}return t}function H(t){return null==t?String(t):"object"==typeof t||"function"==typeof t?Object.prototype.toString.call(t).match(/\s([a-z]+)/i)[1].toLowerCase()||"object":typeof t}function R(t,e){if("array"!==H(e))return-1;if(e.indexOf)return e.indexOf(t);for(var n=0,o=e.length;n<o;n++)if(e[n]===t)return n;return-1}function I(){var t,e=arguments;for(t in e[1])if(e[1].hasOwnProperty(t))switch(H(e[1][t])){case"object":e[0][t]=I({},e[0][t],e[1][t]);break;case"array":e[0][t]=e[1][t].slice(0);break;default:e[0][t]=e[1][t]}return 2<e.length?I.apply(null,[e[0]].concat(Array.prototype.slice.call(e,2))):e[0]}function N(t){return 1===(t=Math.round(255*t).toString(16)).length?"0"+t:t}function S(t,e,n,o){t.addEventListener?t[o?"removeEventListener":"addEventListener"](e,n,!1):t.attachEvent&&t[o?"detachEvent":"attachEvent"]("on"+e,n)}function D(t,e){function g(t,e,n,o){return h[0|t][Math.round(Math.min((e-n)/(o-n)*M,M))]}function r(){F.legend.fps!==q&&(F.legend.fps=q,F.legend[c]=q?"FPS":"ms"),b=q?v.fps:v.duration,F.count[c]=999<b?"999+":b.toFixed(99<b?0:O.decimals)}function m(){for(l=n(),P<l-O.threshold&&(v.fps-=v.fps/Math.max(1,60*O.smoothing/O.interval),v.duration=1e3/v.fps),w=O.history;w--;)T[w]=0===w?v.fps:T[w-1],j[w]=0===w?v.duration:j[w-1];if(r(),O.heat){if(z.length)for(w=z.length;w--;)z[w].el.style[o[z[w].name].heatOn]=q?g(o[z[w].name].heatmap,v.fps,0,O.maxFps):g(o[z[w].name].heatmap,v.duration,O.threshold,0);if(F.graph&&o.column.heatOn)for(w=C.length;w--;)C[w].style[o.column.heatOn]=q?g(o.column.heatmap,T[w],0,O.maxFps):g(o.column.heatmap,j[w],O.threshold,0)}if(F.graph)for(y=0;y<O.history;y++)C[y].style.height=(q?T[y]?Math.round(x/O.maxFps*Math.min(T[y],O.maxFps)):0:j[y]?Math.round(x/O.threshold*Math.min(j[y],O.threshold)):0)+"px"}function k(){20>O.interval?(p=i(k),m()):(p=setTimeout(k,O.interval),f=i(m))}function G(t){(t=t||window.event).preventDefault?(t.preventDefault(),t.stopPropagation()):(t.returnValue=!1,t.cancelBubble=!0),v.toggle()}function U(){O.toggleOn&&S(F.container,O.toggleOn,G,1),t.removeChild(F.container)}function V(){if(F.container&&U(),o=D.theme[O.theme],!(h=o.compiledHeatmaps||[]).length&&o.heatmaps.length){for(y=0;y<o.heatmaps.length;y++)for(h[y]=[],w=0;w<=M;w++){var e,n=h[y],a=w;e=.33/M*w;var i=o.heatmaps[y].saturation,l=o.heatmaps[y].lightness,p=void 0,c=void 0,u=void 0,d=u=void 0,f=p=c=void 0;f=void 0;0===(u=.5>=l?l*(1+i):l+i-l*i)?e="#000":(c=(u-(d=2*l-u))/u,f=(e*=6)-(p=Math.floor(e)),f*=u*c,0===p||6===p?(p=u,c=d+f,u=d):1===p?(p=u-f,c=u,u=d):2===p?(p=d,c=u,u=d+f):3===p?(p=d,c=u-f):4===p?(p=d+f,c=d):(p=u,c=d,u-=f),e="#"+N(p)+N(c)+N(u)),n[a]=e}o.compiledHeatmaps=h}for(var b in F.container=s(document.createElement("div"),o.container),F.count=F.container.appendChild(s(document.createElement("div"),o.count)),F.legend=F.container.appendChild(s(document.createElement("div"),o.legend)),F.graph=O.graph?F.container.appendChild(s(document.createElement("div"),o.graph)):0,z.length=0,F)F[b]&&o[b].heatOn&&z.push({name:b,el:F[b]});if(C.length=0,F.graph)for(F.graph.style.width=O.history*o.column.width+(O.history-1)*o.column.spacing+"px",w=0;w<O.history;w++)C[w]=F.graph.appendChild(s(document.createElement("div"),o.column)),C[w].style.position="absolute",C[w].style.bottom=0,C[w].style.right=w*o.column.width+w*o.column.spacing+"px",C[w].style.width=o.column.width+"px",C[w].style.height="0px";s(F.container,O),r(),t.appendChild(F.container),F.graph&&(x=F.graph.clientHeight),O.toggleOn&&("click"===O.toggleOn&&(F.container.style.cursor="pointer"),S(F.container,O.toggleOn,G))}"object"===H(t)&&undefined===t.nodeType&&(e=t,t=document.body),t||(t=document.body);var o,h,l,p,f,x,b,w,y,v=this,O=I({},D.defaults,e||{}),F={},C=[],M=100,z=[],E=O.threshold,A=0,P=n()-E,T=[],j=[],q="fps"===O.show;v.options=O,v.fps=0,v.duration=0,v.isPaused=0,v.tickStart=function(){A=n()},v.tick=function(){l=n(),E+=(l-P-E)/O.smoothing,v.fps=1e3/E,v.duration=A<P?E:l-A,P=l},v.pause=function(){return p&&(v.isPaused=1,clearTimeout(p),a(p),a(f),p=f=0),v},v.resume=function(){return p||(v.isPaused=0,k()),v},v.set=function(t,e){return O[t]=e,q="fps"===O.show,-1!==R(t,u)&&V(),-1!==R(t,d)&&s(F.container,O),v},v.showDuration=function(){return v.set("show","ms"),v},v.showFps=function(){return v.set("show","fps"),v},v.toggle=function(){return v.set("show",q?"ms":"fps"),v},v.hide=function(){return v.pause(),F.container.style.display="none",v},v.show=function(){return v.resume(),F.container.style.display="block",v},v.destroy=function(){v.pause(),U(),v.tick=v.tickStart=function(){}},V(),k()}var n,o=t.performance;n=o&&(o.now||o.webkitNow)?o[o.now?"now":"webkitNow"].bind(o):function(){return+new Date};for(var a=t.cancelAnimationFrame||t.cancelRequestAnimationFrame,i=t.requestAnimationFrame,h=0,l=0,p=(o=["moz","webkit","o"]).length;l<p&&!a;++l)i=(a=t[o[l]+"CancelAnimationFrame"]||t[o[l]+"CancelRequestAnimationFrame"])&&t[o[l]+"RequestAnimationFrame"];a||(i=function(e){var o=n(),a=Math.max(0,16-(o-h));return h=o+a,t.setTimeout((function(){e(o+a)}),a)},a=function(t){clearTimeout(t)});var c="string"===H(document.createElement("div").textContent)?"textContent":"innerText";D.extend=I,window.FPSMeter=D,D.defaults={interval:100,smoothing:10,show:"fps",toggleOn:"click",decimals:1,maxFps:60,threshold:100,position:"absolute",zIndex:10,left:"5px",top:"5px",right:"auto",bottom:"auto",margin:"0 0 0 0",theme:"dark",heat:0,graph:0,history:20};var u=["toggleOn","theme","heat","graph","history"],d="position zIndex left top right bottom margin".split(" ")}(window),function(t,e){e.theme={};var n=e.theme.base={heatmaps:[],container:{heatOn:null,heatmap:null,padding:"5px",minWidth:"95px",height:"30px",lineHeight:"30px",textAlign:"right",textShadow:"none"},count:{heatOn:null,heatmap:null,position:"absolute",top:0,right:0,padding:"5px 10px",height:"30px",fontSize:"24px",fontFamily:"Consolas, Andale Mono, monospace",zIndex:2},legend:{heatOn:null,heatmap:null,position:"absolute",top:0,left:0,padding:"5px 10px",height:"30px",fontSize:"12px",lineHeight:"32px",fontFamily:"sans-serif",textAlign:"left",zIndex:2},graph:{heatOn:null,heatmap:null,position:"relative",boxSizing:"padding-box",MozBoxSizing:"padding-box",height:"100%",zIndex:1},column:{width:4,spacing:1,heatOn:null,heatmap:null}};e.theme.dark=e.extend({},n,{heatmaps:[{saturation:.8,lightness:.8}],container:{background:"#222",color:"#fff",border:"1px solid #1a1a1a",textShadow:"1px 1px 0 #222"},count:{heatOn:"color"},column:{background:"#3f3f3f"}}),e.theme.light=e.extend({},n,{heatmaps:[{saturation:.5,lightness:.5}],container:{color:"#666",background:"#fff",textShadow:"1px 1px 0 rgba(255,255,255,.5), -1px -1px 0 rgba(255,255,255,.5)",boxShadow:"0 0 0 1px rgba(0,0,0,.1)"},count:{heatOn:"color"},column:{background:"#eaeaea"}}),e.theme.colorful=e.extend({},n,{heatmaps:[{saturation:.5,lightness:.6}],container:{heatOn:"backgroundColor",background:"#888",color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.2)",boxShadow:"0 0 0 1px rgba(0,0,0,.1)"},column:{background:"#777",backgroundColor:"rgba(0,0,0,.2)"}}),e.theme.transparent=e.extend({},n,{heatmaps:[{saturation:.8,lightness:.5}],container:{padding:0,color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.5)"},count:{padding:"0 5px",height:"40px",lineHeight:"40px"},legend:{padding:"0 5px",height:"40px",lineHeight:"42px"},graph:{height:"40px"},column:{width:5,background:"#999",heatOn:"backgroundColor",opacity:.5}})}(window,FPSMeter));var Fps=pc.createScript("fps");Fps.prototype.initialize=function(){this.fps=new FPSMeter({heat:!0,graph:!0})},Fps.prototype.update=function(t){this.fps.tick()};var TouchButton=pc.createScript("touchButton");TouchButton.attributes.add("identifier",{type:"string",default:"button0",title:"Identifier",description:"A unique name for the button to refer to it by in the API. Will give a warning in browser tools if the name is not unique."}),TouchButton.attributes.add("vibration",{type:"number",default:0,title:"Vibration duration (ms)",description:"If the device supports vibration with 'Navigator.vibrate', it will vibrate for the duration set here on touch down.Set to 0 to disable."}),TouchButton.attributes.add("defaultColor",{type:"rgba",default:[1,1,1,1],description:""}),TouchButton.attributes.add("pressedColor",{type:"rgba",default:[1,1,1,1],description:""}),TouchButton.prototype.initialize=function(){window.touchJoypad&&void 0!==window.touchJoypad.buttonStates[this.identifier]?console.warn("Touch button identifier already used, please use another for Entity: "+this.entity.name):(this._canVibrate=!!navigator.vibrate,console.log(this._canVibrate),this._setState(!1),this.on("state",(t=>{this._setEvents(t?"on":"off")})),this.on("destroy",(()=>{window.touchJoypad&&(window.touchJoypad.buttonStates[this.identifier]=void 0)})),this._setEvents("on"))},TouchButton.prototype._setEvents=function(t){this._state=!1,this.entity.element[t]("mousedown",this._onMouseDown,this),this.entity.element[t]("mouseup",this._onMouseUp,this),this.app.touch&&(this.entity.element[t]("touchstart",this._onTouchDown,this),this.entity.element[t]("touchend",this._onTouchUp,this),this.entity.element[t]("touchcancel",this._onTouchUp,this)),this.app.xr.input&&(this.app.xr.input[t]("selectstart",this._onXRInputSelectStart,this),this.app.xr.input[t]("selectend",this._onXRInputSelectEnd,this))},TouchButton.prototype._onMouseDown=function(t){this._state||(this._onPointerDown(),t.stopPropagation())},TouchButton.prototype._onMouseUp=function(t){this._state&&(this._onPointerUp(),t.stopPropagation())},TouchButton.prototype._onTouchDown=function(t){this._state||(this._onPointerDown(),t.stopPropagation())},TouchButton.prototype._onTouchUp=function(t){this._state&&(this._onPointerUp(),t.stopPropagation()),t.event.preventDefault()},TouchButton.prototype._onXRInputSelectStart=function(t,o){var e=this._getEvent(t),i=this._getLimits();e.x<i.min.x||e.x>i.max.x||e.y<i.min.y||e.y>i.max.y||this._state||(this._onPointerDown(),o.stopPropagation())},TouchButton.prototype._onXRInputSelectEnd=function(t,o){this._state&&(this._onPointerUp(),o.stopPropagation()),o.preventDefault()},TouchButton.prototype._onPointerDown=function(){this._canVibrate&&0!==this.vibration&&navigator.vibrate(this.vibration),this._setState(!0)},TouchButton.prototype._onPointerUp=function(){this._setState(!1)},TouchButton.prototype._setState=function(t){window.touchJoypad&&(window.touchJoypad.buttonStates[this.identifier]=t?Date.now():null),this.entity.element.color=t?this.pressedColor:this.defaultColor,this._state=t},TouchButton.prototype._getEvent=function(t){if(!t)return;let o=t.gamepad.axes;const e=this.app.graphicsDevice.canvas.clientWidth,i=this.app.graphicsDevice.canvas.clientHeight;let n=o[0];n=(n+1)/2,n=pc.math.lerp(n,e,n);let s=o[1];return s=(s+1)/2,s=pc.math.lerp(s,i,s),{x:n,y:s}},TouchButton.prototype._getLimits=function(){this.app.graphicsDevice.canvas.clientWidth;const t=this.app.graphicsDevice.canvas.clientHeight;var o=this.entity.element.screenCorners;return{min:{x:o[3].x,y:t-o[3].y},max:{x:o[1].x,y:t-o[1].y}}};!function(){const t={},n={},o={buttons:{isPressed:function(t){return!!n[t]},wasPressed:function(o){const e=n[o],s=t[o];return void 0!==n[o]&&(!s&&e)},wasReleased:function(o){const e=n[o],s=t[o];return void 0!==n[o]&&(s&&!e)},wasTapped:function(n){if(this.wasReleased(n)){return Date.now()-t[n]<=200}return!1}},sticks:{}};o.buttonStates=n;pc.Application.getApplication().on("update",(()=>{for(const o of Object.keys(n)){const e=n[o];t[o]=e}})),window.touchJoypad=o}();var TouchJoystick=pc.createScript("touchJoystick");TouchJoystick.attributes.add("identifier",{type:"string",default:"joystick0",title:"Idenitifier",description:"A unique name for the joystick to refer to it by in the API. Joysticks are also buttons so this will also be the name of button in the API. It will give a warning in browser tools if the name is not unique."}),TouchJoystick.attributes.add("type",{type:"string",default:"fixed",enum:[{"Fixed in place":"fixed"},{"Move to first touch and fixed":"relative"},{"Move to first touch and drags":"drag"}],title:"Type",description:"Set type of behavior for the joystick."}),TouchJoystick.attributes.add("baseEntity",{type:"entity",title:"Base Entity",description:"Image Element Entity that shows the base of the joystick."}),TouchJoystick.attributes.add("nubEntity",{type:"entity",title:"Nub Entity",description:"Image Element Entity that shows the nub (top) of the joystick."}),TouchJoystick.attributes.add("axisDeadZone",{type:"number",default:10,title:"Axis Dead Zone",description:"The number of UI units from the position of the Base Entity where input is not registered."}),TouchJoystick.attributes.add("axisRange",{type:"number",default:50,title:"Axis Range",description:"The number of UI units from the position of the Base Entity that the Nub Entity can move to and is the maximum range"}),TouchJoystick.attributes.add("hideOnRelease",{type:"boolean",default:!1,title:"Hide on Release",description:"Will only show the joystick when the user is using it and will hide it on touch end. This is commonly used if you don't want the joystick to block what's being shown on screen."}),TouchJoystick.attributes.add("positionOnRelease",{type:"string",default:"stay",enum:[{Stay:"stay"},{Original:"original"},{"Last start":"lastStart"}],title:"Position on Release",description:"Where to move the joystick on release and can help keep the screen tidy so that there are clear areas to show the game and arrange controls."}),TouchJoystick.attributes.add("vibrationPress",{type:"number",default:0,title:"Vibration duration (ms)",description:"If the device supports vibration with 'Navigator.vibrate', it will vibrate for the duration set here on touch down.Set to 0 to disable."}),TouchJoystick.prototype.initialize=function(){window.touchJoypad&&void 0!==window.touchJoypad.sticks[this.identifier]?console.warn("Touch joystick identifier already used, please use another for Entity: "+this.entity.name):(this._originalLocalPosition=this.baseEntity.getLocalPosition().clone(),this._lastPointerDownPosition=new pc.Vec3,this._pointerDown=!1,this._pointerId=-1,this._setAxisValues(0,0),this._canVibrate=!!navigator.vibrate,this._setButtonState(!1),this.on("state",(t=>{this._setEvents(t?"on":"off")})),this.on("destroy",(()=>{window.touchJoypad&&(window.touchJoypad.sticks[this.identifier]=void 0)})),this._setEvents("on"))},TouchJoystick.prototype.update=function(t){this.app.xr.input&&this.currentInputSource&&this.currentEvent&&this._onXRInputSelectMove(this.currentInputSource,this.currentEvent)},TouchJoystick.prototype._setEvents=function(t){this._setAxisValues(0,0),this._pointerDown=!1,this._pointerId=-1,this.baseEntity.enabled=!this.hideOnRelease,this.entity.element[t]("mousedown",this._onMouseDown,this),this.entity.element[t]("mousemove",this._onMouseMove,this),this.entity.element[t]("mouseup",this._onMouseUp,this),this.app.touch&&(this.entity.element[t]("touchstart",this._onTouchDown,this),this.entity.element[t]("touchmove",this._onTouchMove,this),this.entity.element[t]("touchend",this._onTouchUp,this),this.entity.element[t]("touchcancel",this._onTouchUp,this)),this.app.xr.input&&(this.app.xr.input[t]("selectstart",this._onXRInputSelectStart,this),this.app.xr.input[t]("selectend",this._onXRInputSelectEnd,this))},TouchJoystick.__uiPos=new pc.Vec2,TouchJoystick.prototype.screenToUi=function(t){const i=TouchJoystick.__uiPos,e=this.app.graphicsDevice.canvas.clientWidth,o=this.app.graphicsDevice.canvas.clientHeight;return i.x=t.x/e,i.y=t.y/o,i.mulScalar(2).subScalar(1),i.y*=-1,i},TouchJoystick.prototype._onMouseDown=function(t){t.id=0,this._onPointerDown(t),this._pointerDown&&t.stopPropagation()},TouchJoystick.prototype._onMouseMove=function(t){t.id=0,this._onPointerMove(t),this._pointerDown&&t.stopPropagation()},TouchJoystick.prototype._onMouseUp=function(t){t.id=0,this._pointerDown&&t.stopPropagation(),this._onPointerUp(t)},TouchJoystick.prototype._onTouchDown=function(t){if(this._pointerDown)return;const i=this._pointerDown;t.id=t.touch.identifier,this._onPointerDown(t),!i&&this._pointerDown&&t.stopPropagation()},TouchJoystick.prototype._onTouchMove=function(t){t.id=t.touch.identifier,this._onPointerMove(t),this._pointerDown&&t.stopPropagation(),t.event.preventDefault()},TouchJoystick.prototype._onTouchUp=function(t){this._pointerDown&&(t.id=t.touch.identifier,this._onPointerUp(t),t.stopPropagation()),t.event.preventDefault()},TouchJoystick.prototype._onXRInputSelectStart=function(t,i){if(this._pointerDown)return;var e=this._getEvent(t),o=this._getLimits();if(e.x<o.min.x||e.x>o.max.x)return;if(e.y<o.min.y||e.y>o.max.y)return;this.currentInputSource=t,this.currentEvent=i,i.x=e.x,i.y=e.y;const n=this._pointerDown;i.id=t.id,this._onPointerDown(i),!n&&this._pointerDown&&i.stopPropagation()},TouchJoystick.prototype._onXRInputSelectMove=function(t,i){i.type="selectmove";var e=this._getEvent(t);i.x=e.x,i.y=e.y,i.id=t.id,this._onPointerMove(i),this._pointerDown&&i.stopPropagation(),i.preventDefault()},TouchJoystick.prototype._onXRInputSelectEnd=function(t,i){if(this._pointerDown){var e=this._getEvent(t);i.x=e.x,i.y=e.y,i.id=t.id,this._onPointerUp(i),i.stopPropagation(),this.currentInputSource=null,this.currentEvent=null}},TouchJoystick.__tempNubPos=new pc.Vec3,TouchJoystick.__tempBasePos=new pc.Vec3,TouchJoystick.prototype._onPointerDown=function(t){const i=this.screenToUi(t);switch(this.type){case"drag":case"relative":this.baseEntity.setPosition(i.x,i.y,0),this.nubEntity.setLocalPosition(0,0,0),this._pointerDown=!0;break;case"fixed":this.nubEntity.setPosition(i.x,i.y,0),this._updateAxisValuesFromNub(),this._pointerDown=!0}this._pointerDown&&(this._canVibrate&&0!==this.vibrationPress&&navigator.vibrate(this.vibrationPress),this._pointerId=t.id?t.id:0,this._setButtonState(!0),this._lastPointerDownPosition.copy(this.baseEntity.getLocalPosition()),this.baseEntity.enabled=!0,this._onPointerMove(t))},TouchJoystick.prototype._onPointerMove=function(t){if(this._pointerDown&&this._pointerId==t.id){const i=this.screenToUi(t),e=this.axisRange*this.axisRange;this.nubEntity.setPosition(i.x,i.y,0);const o=TouchJoystick.__tempNubPos;o.copy(this.nubEntity.getLocalPosition());if(o.lengthSq()>=e){if("drag"===this.type){const t=o.length()-this.axisRange,i=TouchJoystick.__tempBasePos;i.copy(o),i.normalize().mulScalar(t),i.add(this.baseEntity.getLocalPosition()),this.baseEntity.setLocalPosition(i)}o.normalize().mulScalar(this.axisRange),this.nubEntity.setLocalPosition(o)}this._updateAxisValuesFromNub()}},TouchJoystick.prototype._onPointerUp=function(t){if(this._pointerDown&&this._pointerId==t.id){switch(this.nubEntity.setLocalPosition(0,0,0),this.hideOnRelease&&(this.baseEntity.enabled=!1),this.positionOnRelease){case"original":this.baseEntity.setLocalPosition(this._originalLocalPosition);break;case"lastStart":this.baseEntity.setLocalPosition(this._lastPointerDownPosition)}this._pointerId=-1,this._pointerDown=!1,this._updateAxisValuesFromNub(),this._setButtonState(!1)}},TouchJoystick.prototype._updateAxisValuesFromNub=function(){const t=this.axisRange-this.axisDeadZone,i=this.nubEntity.getLocalPosition(),e=Math.sign(i.x),o=Math.sign(i.y),n=pc.math.clamp(Math.abs(i.x)-this.axisDeadZone,0,t)*e,s=pc.math.clamp(Math.abs(i.y)-this.axisDeadZone,0,t)*o;this._setAxisValues(n/t,s/t)},TouchJoystick.prototype._setAxisValues=function(t,i){window.touchJoypad&&(window.touchJoypad.sticks[this.identifier]={x:t,y:i,isPressed:this._pointerDown}),this.axisX=t,this.axisY=i},TouchJoystick.prototype._setButtonState=function(t){window.touchJoypad&&(window.touchJoypad.buttonStates[this.identifier]=t?Date.now():null),this._state=t},TouchJoystick.prototype._getEvent=function(t){if(!t)return;let i=t.gamepad.axes;const e=this.app.graphicsDevice.canvas.clientWidth,o=this.app.graphicsDevice.canvas.clientHeight;let n=i[0];n=(n+1)/2,n=pc.math.lerp(n,e,n);let s=i[1];return s=(s+1)/2,s=pc.math.lerp(s,o,s),{x:n,y:s}},TouchJoystick.prototype._getLimits=function(){this.app.graphicsDevice.canvas.clientWidth;const t=this.app.graphicsDevice.canvas.clientHeight;var i=this.entity.element.screenCorners;return{min:{x:i[3].x,y:t-i[3].y},max:{x:i[1].x,y:t-i[1].y}}};var TouchButtonTester=pc.createScript("touchButtonTester");TouchButtonTester.attributes.add("identifier",{type:"string",default:"button0",title:"Idenitifier"}),TouchButtonTester.prototype.update=function(t){if(window.touchJoypad.buttons.wasPressed(this.identifier)){var e=this.identifier+" was pressed";console.log(e)}if(window.touchJoypad.buttons.wasReleased(this.identifier)){e=this.identifier+" was released";console.log(e)}if(window.touchJoypad.buttons.wasTapped(this.identifier)){e=this.identifier+" was tapped";console.log(e)}};var TouchJoystickTester=pc.createScript("touchJoystickTester");TouchJoystickTester.attributes.add("identifier",{type:"string",default:"joystick0",title:"Idenitifier"}),TouchJoystickTester.prototype.update=function(t){var e=window.touchJoypad.sticks[this.identifier];if(e&&e.isPressed){var i=this.identifier+" is pressed";console.log(i);var s={x:e.x,y:e.y};console.log(s)}};var Rotate=pc.createScript("rotate");Rotate.attributes.add("rotationSpeed",{type:"number",default:30,precision:2}),Rotate.prototype.initialize=function(){this.rot=0;var t=this;this.app.xr.on("start",(function(){t.enabled=!1}))},Rotate.prototype.update=function(t){this.keyboardInput(t),this.rotate()},Rotate.prototype.rotate=function(t){var e=new pc.Quat;e.setFromEulerAngles(0,this.rot,0),this.entity.setRotation(e)},Rotate.prototype.keyboardInput=function(t){this.app.keyboard.isPressed(pc.KEY_Q)?this.rot-=t*this.rotationSpeed:this.app.keyboard.isPressed(pc.KEY_E)&&(this.rot+=t*this.rotationSpeed)};var XrBasic=pc.createScript("xrBasic");XrBasic.attributes.add("xrStartButton",{type:"entity"}),XrBasic.attributes.add("xrNotSupportedText",{type:"entity"}),XrBasic.attributes.add("planeDetectionNotSupportedText",{type:"entity"}),XrBasic.attributes.add("hitTestNotSupportedText",{type:"entity"}),XrBasic.attributes.add("moveAround",{type:"entity"}),XrBasic.attributes.add("cameraEntity",{type:"entity"}),XrBasic.prototype.initialize=function(){this.xrNotSupportedText.enabled=!1,this.planeDetectionNotSupportedText.enabled=!1,this.hitTestNotSupportedText.enabled=!1,this.moveAround.enabled=!1,this.app.xr.on("available:"+pc.XRTYPE_AR,this.xrAvailable,this),this.app.xr.on("start",this.xrStart,this),this.app.xr.on("end",this.xrEnd,this),this.app.xr.on("error",this.xrError,this),this.app.xr.planeDetection.on("add",this.xrPlaneDetectionAdd,this)},XrBasic.prototype.startXR=function(){return this.xrStartButton.enabled=!1,this.app.xr.supported&&this.app.xr.isAvailable(pc.XRTYPE_AR)?this.app.xr.planeDetection&&this.app.xr.planeDetection.supported?this.app.xr.hitTest&&this.app.xr.hitTest.supported?(this.cameraEntity.camera.clearColor=new pc.Color(0,0,0,0),this.cameraEntity.camera.startXr(pc.XRTYPE_AR,pc.XRSPACE_LOCALFLOOR,{planeDetection:!0}),this.moveAround.enabled=!0,!0):(this.hitTestNotSupportedText.enabled=!0,!1):(this.planeDetectionNotSupportedText.enabled=!0,!1):(this.xrNotSupportedText.enabled=!0,!1)},XrBasic.prototype.xrAvailable=function(t){},XrBasic.prototype.xrStart=function(){},XrBasic.prototype.xrEnd=function(){},XrBasic.prototype.xrError=function(t){console.log(t)},XrBasic.prototype.xrPlaneDetectionAdd=function(){this.moveAround.enabled=!1};var ArButton=pc.createScript("arButton");ArButton.attributes.add("gameManager",{type:"entity",title:"Game Manager"}),ArButton.prototype.initialize=function(){this.entity.button.on("click",this.clickButton,this)},ArButton.prototype.clickButton=function(){this.gameManager.script.gameManager.startARSplash()};var Plane=pc.createScript("plane");Plane.prototype.initialize=function(){this.vec3A=new pc.Vec3,this.vec3B=new pc.Vec3,this.color=new pc.Color(1,1,1),this.entity.addComponent("collision",{type:"mesh"}),this.entity.addComponent("rigidbody",{type:"static"}),this.mesh=new pc.Mesh(this.app.graphicsDevice),this.mesh.setPositions([0,0,0,0,0,0,0,0,0]),this.mesh.setUvs(0,[0,0,0,0,0,0]),this.mesh.setIndices([0,0,0]),this.mesh.update();let e=this.entity.render.materialAssets[0],s=this.app.assets.get(e).resource;this.meshInstance=new pc.MeshInstance(this.mesh,s),this.entity.render.meshInstances=[this.meshInstance],this.plane&&this.updateMesh()},Plane.prototype.setPlane=function(e){this.plane=e,this.plane.on("change",(()=>{this.updateMesh()})),this.plane.once("remove",(()=>{this.entity.destroy()})),this.mesh&&this.updateMesh()},Plane.prototype.updateMesh=function(){if(this.mesh=new pc.Mesh(this.app.graphicsDevice),this.meshInstance.mesh=this.mesh,this.mesh.clear(!0,!1),this.plane){let e=[],s=[],t=[];e.push(0),e.push(0),e.push(0),t.push(0),t.push(0);const h=this.plane._xrPlane.polygon;for(let s=0;s<h.length;s++)e.push(h[s].x),e.push(h[s].y),e.push(h[s].z),t.push(h[s].x),t.push(h[s].z);for(let e=0;e<h.length;e++)s.push(0),s.push(e+1),s.push((e+1)%h.length+1);this.mesh.setPositions(e),this.mesh.setUvs(0,t),this.mesh.setIndices(s),this.mesh.update(),this.createCollision(),this.entity.render.enabled=!0}else this.entity.render.enabled=!1},Plane.prototype.update=function(e){this.plane&&this.entity.rigidbody.teleport(this.plane.getPosition(),this.plane.getRotation())},Plane.prototype.createCollision=function(){var e=new pc.GraphNode,s=new pc.MeshInstance(this.mesh,this.app.assets.get(this.entity.render.materialAssets[0]).resource,e),t=new pc.Model;t.graph=e,t.meshInstances.push(s),this.entity.collision.model=t};var PlaneDetection=pc.createScript("planeDetection");PlaneDetection.attributes.add("template",{type:"asset",assetType:"template"}),PlaneDetection.prototype.initialize=function(){this.app.xr.planeDetection&&this.app.xr.planeDetection.on("add",(t=>{let e=this.template.resource.instantiate();e.script.plane.setPlane(t),this.entity.addChild(e)}))};var HitTest=pc.createScript("hitTest");HitTest.attributes.add("pointer",{type:"entity"}),HitTest.attributes.add("startEnabled",{type:"boolean",default:!0}),HitTest.prototype.initialize=function(){if(this.resetPointer(),this.pointerEnabled=!1,this.app.xr.hitTest){this.startEnabled&&this.enablePointer();var t=this;this.app.xr.on("start",(function(){this.app.xr.hitTest.start({spaceType:pc.XRSPACE_VIEWER,callback:function(e,i){i.on("result",(function(e,i){t.pointerEnabled&&(t.pointerPos=e,t.pointerRot=i,t.pointerUpdated=1)}))}})})),this.app.on("xr:enableHitTestPointer",this.enablePointer,this),this.app.on("xr:disableHitTestPointer",this.disablePointer,this)}else console.warn("XR Hit Test not available, Hit Test Cursor Can't be enabled")},HitTest.prototype.update=function(){this.app.xr.hitTest&&this.pointerEnabled&&this.updatePointer()},HitTest.prototype.enablePointer=function(){this.app.xr.hitTest?this.pointerEnabled||(this.pointerEnabled=!0,this.resetPointer()):console.warn("XR Hit Test not available, Hit Test Cursor Can't be enabled")},HitTest.prototype.updatePointer=function(){if(1===this.pointerUpdated){if(this.pointer.enabled=!0,this.pointer.setPosition(this.pointerPos),this.pointer.setRotation(this.pointerRot),this.pointerUpdated=2,this.app.xr.input.inputSources.length){var t=Date.now();t-this.lastCreated>200&&(this.lastCreated=t,this.app.fire("xr:hitTestPointerPressed",this.pointerPos,this.pointerRot))}}else 2===this.pointerUpdated&&(this.pointerUpdated=0,this.pointer.enabled=!1)},HitTest.prototype.disablePointer=function(){this.pointerEnabled&&(this.pointerEnabled=!1,this.resetPointer())},HitTest.prototype.resetPointer=function(){this.lastCreated=0,this.pointerUpdated=0,this.pointerPos=new pc.Vec3,this.pointerRot=new pc.Quat,this.pointer.setPosition(this.pointerPos),this.pointer.setRotation(this.pointerRot),this.pointer.enabled=!1};